# ๐ ะัะฐัะบะฐั ัะฒะพะดะบะฐ ะฟัะพะตะบัะฐ Vending Admin v2

**ะะฐัะฐ ัะพะทะดะฐะฝะธั:** 12.01.2026  
**ะกัะฐััั:** ะะพะดะณะพัะพะฒะบะฐ ะบ ัะฐะทัะฐะฑะพัะบะต  
**GitHub:** https://github.com/geodez/vending-admin-v2

---

## ๐ฏ ะงัะพ ััะพ?

ะกะพะฒัะตะผะตะฝะฝะฐั ะฐะดะผะธะฝะธัััะฐัะธะฒะฝะฐั ะฟะฐะฝะตะปั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฒะตะฝะดะธะฝะณะพะฒัะผ ะฑะธะทะฝะตัะพะผ ั ะฐััะตะฝัะธัะธะบะฐัะธะตะน ัะตัะตะท **Telegram Mini App**.

### ะะปะฐะฒะฝัะต ะพัะปะธัะธั ะพั ััะฐัะพะณะพ ะฟัะพะตะบัะฐ:

| ะัะธัะตัะธะน | ะกัะฐััะน ะฟัะพะตะบั | ะะพะฒัะน ะฟัะพะตะบั (v2) |
|----------|---------------|-------------------|
| **ะััะตะฝัะธัะธะบะฐัะธั** | ะขะพะบะตะฝ ะฒ URL | Telegram user_id + JWT |
| **Frontend** | Vanilla JS + ECharts | React + TypeScript + Telegram Mini App |
| **UI** | ะกะฐะผะพะฟะธัะฝัะต ััะธะปะธ | Ant Design + ัะตะผะฝะฐั/ัะฒะตัะปะฐั ัะตะผะฐ |
| **ะะพะปะธ** | ะะตั ัะฐะทะดะตะปะตะฝะธั | Owner / Operator ั RBAC |
| **ะััะธัะตะบัััะฐ** | ะะพะฝะพะปะธัะฝะฐั | ะงะธััะฐั ะฐััะธัะตะบัััะฐ (Clean Architecture) |
| **ะขะตััะธัะพะฒะฐะฝะธะต** | ะะตั | Unit + Integration + E2E tests |
| **ะะตะฟะปะพะน** | ะััะฝะพะน | CI/CD ัะตัะตะท GitHub Actions |

---

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        Telegram Mini App (Frontend)              โ
โ     React 18 + TypeScript + Ant Design           โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โ REST API (JWT)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            FastAPI Backend                       โ
โ   โข Telegram Auth + JWT                          โ
โ   โข RBAC (Owner / Operator)                      โ
โ   โข Business Logic                               โ
โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โ SQLAlchemy ORM
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         PostgreSQL 16 Database                   โ
โ   โข Users & Permissions                          โ
โ   โข Vendista Data (sync)                         โ
โ   โข Business Data (recipes, inventory, etc.)     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะััะตะฝัะธัะธะบะฐัะธั ัะตัะตะท Telegram

### ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั:

1. **ะะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั Mini App ะฒ Telegram**
   - Telegram ะฟะตัะตะดะฐะตั `initData` ั user_id, username, hash

2. **Backend ะฒะฐะปะธะดะธััะตั initData**
   - ะัะพะฒะตัะบะฐ HMAC-SHA256 ะฟะพะดะฟะธัะธ
   - ะัะพะฒะตัะบะฐ ััะพะบะฐ ะดะตะนััะฒะธั (ะฝะต ััะฐััะต 24 ัะฐัะพะฒ)

3. **ะัะดะฐัะฐ JWT ัะพะบะตะฝะฐ**
   - ะัะปะธ user_id ะตััั ะฒ ะะ ะธ ะฐะบัะธะฒะตะฝ
   - ะขะพะบะตะฝ ัะพะดะตัะถะธั: user_id, role, permissions

4. **ะัะต API ะทะฐะฟัะพัั ั ัะพะบะตะฝะพะผ**
   - Authorization: Bearer {JWT_TOKEN}

### ะะพะปะธ ะธ ะฟัะฐะฒะฐ:

**ะกะพะฑััะฒะตะฝะฝะธะบ (Owner):**
- โ ะัะต ัะบัะฐะฝั ะธ ััะฝะบัะธะธ
- โ ะคะธะฝะฐะฝัะพะฒัะต ะพััะตัั (ัะธััะฐั ะฟัะธะฑัะปั)
- โ ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ
- โ ะะฐัััะพะนะบะธ ัะธััะตะผั

**ะะฟะตัะฐัะพั (Operator):**
- โ ะะฑะทะพั, ะัะพะดะฐะถะธ, ะกะบะปะฐะด
- โ ะะตัะตะฟัั, ะะฝะณัะตะดะธะตะฝัั
- โ ะะฝะพะฟะบะธ ัะตัะผะธะฝะฐะปะฐ
- โ ะะตัะตะผะตะฝะฝัะต ัะฐััะพะดั
- โ ะััะตั ัะพะฑััะฒะตะฝะฝะธะบะฐ
- โ ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ

---

## ๐ฑ ะญะบัะฐะฝั ะฐะดะผะธะฝ-ะฟะฐะฝะตะปะธ (9 ัะฐะทะดะตะปะพะฒ)

| โ | ะญะบัะฐะฝ | ะะฟะธัะฐะฝะธะต | Owner | Operator |
|---|-------|----------|-------|----------|
| 1 | **ะะฑะทะพั** | Dashboard ั KPI ะธ ะฐะปะตััะฐะผะธ | โ | โ |
| 2 | **ะัะพะดะฐะถะธ** | ะะฝะฐะปะธัะธะบะฐ ะฟัะพะดะฐะถ, ะณัะฐัะธะบะธ | โ | โ |
| 3 | **ะกะบะปะฐะด** | ะััะฐัะบะธ, ะทะฐะณััะทะบะธ, ัะฐััะพะด | โ | โ |
| 4 | **ะะตัะตะฟัั** | ะฃะฟัะฐะฒะปะตะฝะธะต ัะตัะตะฟัะฐะผะธ ะฟะพ ะปะพะบะฐัะธัะผ | โ | โ |
| 5 | **ะะฝะณัะตะดะธะตะฝัั** | ะกะฟัะฐะฒะพัะฝะธะบ ะธะฝะณัะตะดะธะตะฝัะพะฒ | โ | โ |
| 6 | **ะะฝะพะฟะบะธ ัะตัะผะธะฝะฐะปะฐ** | ะัะธะฒัะทะบะฐ ัะตัะตะฟัะพะฒ ะบ ะบะฝะพะฟะบะฐะผ | โ | โ |
| 7 | **ะะตัะตะผะตะฝะฝัะต ัะฐััะพะดั** | ะััะฝะพะน ััะตั ัะฐััะพะดะพะฒ | โ | โ |
| 8 | **ะััะตั ัะพะฑััะฒะตะฝะฝะธะบะฐ** | ะคะธะฝะฐะฝัะพะฒัะน ะพััะตั + ะฟัะพะฑะปะตะผั | โ | โ |
| 9 | **ะะฐัััะพะนะบะธ** | ะะพะปัะทะพะฒะฐัะตะปะธ, ะบะฐัะตะณะพัะธะธ, ะผะฐะฟะฟะธะฝะณ | โ | โ |

---

## ๐งฎ ะะปััะตะฒัะต ะฑะธะทะฝะตั-ะฟัะฐะฒะธะปะฐ

### 1. ะะฐััะตั ัะตะฑะตััะพะธะผะพััะธ (COGS)
```python
COGS = SUM(
    recipe_item.qty * ingredient.cost_per_unit
    WHERE ingredient.expense_kind = 'stock_tracked'  # ัะพะปัะบะพ ะฟะพััะพัะฝะฝัะต
)
```

### 2. ะะฐะปะพะฒะฐั ะฟัะธะฑัะปั
```python
Gross Profit = Revenue - COGS
Gross Margin % = (Gross Profit / Revenue) ร 100
```

### 3. ะงะธััะฐั ะฟัะธะฑัะปั
```python
Net Profit = Gross Profit - Variable Expenses
Net Margin % = (Net Profit / Revenue) ร 100
```

### 4. ะััะฐัะบะธ ัะบะปะฐะดะฐ
```python
Balance = SUM(loads) - SUM(usage)
# ะขะพะปัะบะพ ะดะปั ะฟะพััะพัะฝะฝัั ะธะฝะณัะตะดะธะตะฝัะพะฒ (expense_kind = 'stock_tracked')
```

### 5. ะะปะตััั
```python
if qty_balance <= alert_threshold:
    alert_level = 'LOW_STOCK'  # ะัะธัะธัะฝะพ

if days_left <= alert_days_threshold:
    alert_level = 'DAYS_LEFT'  # ะัะตะดัะฟัะตะถะดะตะฝะธะต

days_left = qty_balance / avg_daily_usage_7d
```

---

## ๐ ะะปะฐะฝ ัะฐะทัะฐะฑะพัะบะธ

| ะญัะฐะฟ | ะะฟะธัะฐะฝะธะต | ะะปะธัะตะปัะฝะพััั | ะกัะฐััั |
|------|----------|--------------|--------|
| **1** | ะะฝััะฐััััะบัััะฐ + Auth | 1 ะฝะตะดะตะปั | ๐ก ะะพะดะณะพัะพะฒะบะฐ |
| **2** | ะกะธะฝััะพะฝะธะทะฐัะธั Vendista | 3-4 ะดะฝั | โณ ะะถะธะดะฐะฝะธะต |
| **3** | CRUD ัััะฝะพััะตะน | 1 ะฝะตะดะตะปั | โณ ะะถะธะดะฐะฝะธะต |
| **4** | ะกะบะปะฐะด ะธ ะทะฐะณััะทะบะธ | 3-4 ะดะฝั | โณ ะะถะธะดะฐะฝะธะต |
| **5** | ะัะพะดะฐะถะธ ะธ KPI | 1 ะฝะตะดะตะปั | โณ ะะถะธะดะฐะฝะธะต |
| **6** | ะะตัะตะผะตะฝะฝัะต ัะฐััะพะดั | 2-3 ะดะฝั | โณ ะะถะธะดะฐะฝะธะต |
| **7** | ะััะตั ัะพะฑััะฒะตะฝะฝะธะบะฐ | 3-4 ะดะฝั | โณ ะะถะธะดะฐะฝะธะต |
| **8** | ะะฐัััะพะนะบะธ | 2-3 ะดะฝั | โณ ะะถะธะดะฐะฝะธะต |
| **9** | ะขะตััะธัะพะฒะฐะฝะธะต + ะะตะฟะปะพะน | 1 ะฝะตะดะตะปั | โณ ะะถะธะดะฐะฝะธะต |

**ะะฑัะฐั ะดะปะธัะตะปัะฝะพััั:** 5-6 ะฝะตะดะตะปั  
**ะกัะฐัั ัะฐะทัะฐะฑะพัะบะธ:** ะะพัะปะต ััะฒะตัะถะดะตะฝะธั ะฐััะธัะตะบัััั

---

## ๐ ะะพะบัะผะตะฝัะฐัะธั

- **[README.md](./README.md)** โ ะพัะฝะพะฒะฝะฐั ะธะฝัะพัะผะฐัะธั
- **[ARCHITECTURE.md](./ARCHITECTURE.md)** โ ะดะตัะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ (30+ ัััะฐะฝะธั)
- **[API_REFERENCE.md](./API_REFERENCE.md)** โ ัะฟัะฐะฒะพัะฝะธะบ API ะธ ะะ (ะธะท ััะฐัะพะณะพ ะฟัะพะตะบัะฐ)
- **[DEVELOPMENT_PLAN.md](./DEVELOPMENT_PLAN.md)** โ ะฟะปะฐะฝ ัะฐะทัะฐะฑะพัะบะธ ั ัะตะบ-ะปะธััะฐะผะธ

---

## ๐ ะกัะฐััะน ะฟัะพะตะบั ะบะฐะบ ัะฟัะฐะฒะพัะฝะธะบ

ะะตะฟะพะทะธัะพัะธะน **[geodez/vending](https://github.com/geodez/vending)** ะธัะฟะพะปัะทัะตััั ะบะฐะบ:

1. **ะกะฟัะฐะฒะพัะฝะธะบ ะฟะพ Vendista API**
   - ะกัััะบัััะฐ payload ััะฐะฝะทะฐะบัะธะน
   - Endpoints ะดะปั ัะธะฝััะพะฝะธะทะฐัะธะธ
   - ะัะธะผะตัั ะดะฐะฝะฝัั

2. **ะกะฟัะฐะฒะพัะฝะธะบ ะฟะพ ะะ**
   - ะกััะตััะฒัััะธะต views (vw_kpi_daily, vw_tx_cogs, ะธ ั.ะด.)
   - ะะพะณะธะบะฐ ัะฐััะตัะพะฒ
   - ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ

3. **ะะธะทะฝะตั-ะปะพะณะธะบะฐ**
   - ะคะพัะผัะปั COGS, ะผะฐัะถะธะฝะฐะปัะฝะพััะธ
   - ะะปะณะพัะธัะผั ะฐะปะตััะพะฒ
   - ะัะฐะฒะธะปะฐ ัะฐััะตัะฐ ะพััะฐัะบะพะฒ

**โ๏ธ ะะฐะถะฝะพ:** ะกัะฐััะน ะฟัะพะตะบั ะะ ัะดะฐะปัะตััั, ะธัะฟะพะปัะทัะตััั read-only!

---

## ๐๏ธ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

### Backend
- **Python 3.12+**
- **FastAPI** โ async REST API
- **SQLAlchemy 2.0** โ ORM
- **PostgreSQL 16** โ ะฑะฐะทะฐ ะดะฐะฝะฝัั
- **Alembic** โ ะผะธะณัะฐัะธะธ
- **python-jose** โ JWT ัะพะบะตะฝั
- **httpx** โ async HTTP client ะดะปั Vendista API

### Frontend
- **React 18** + **TypeScript 5**
- **Vite** โ build tool
- **React Router v6** โ ัะพััะธะฝะณ
- **Zustand** โ state management
- **Ant Design** โ UI ะบะพะผะฟะพะฝะตะฝัั
- **Recharts** โ ะณัะฐัะธะบะธ
- **@twa-dev/sdk** โ Telegram Mini App SDK
- **Axios** โ HTTP client

### DevOps
- **Docker** + **Docker Compose**
- **GitHub Actions** โ CI/CD
- **Caddy** โ reverse proxy
- **systemd** โ ัะฟัะฐะฒะปะตะฝะธะต ัะตัะฒะธัะฐะผะธ

---

## โ ะัะตะธะผััะตััะฒะฐ ะฝะพะฒะพะน ะฐััะธัะตะบัััั

1. โ **ะะตะทะพะฟะฐัะฝะพััั** โ ะฐััะตะฝัะธัะธะบะฐัะธั ัะตัะตะท Telegram (ะฑะตะท ะฟะฐัะพะปะตะน)
2. โ **ะะธะฑะบะพััั** โ RBAC ะฟะพะทะฒะพะปัะตั ะฝะฐัััะฐะธะฒะฐัั ะฟัะฐะฒะฐ
3. โ **ะกะพะฒัะตะผะตะฝะฝะพััั** โ TypeScript, React 18, FastAPI
4. โ **UX** โ Telegram Mini App (ะฝะฐัะธะฒะฝะพะต ะพัััะตะฝะธะต)
5. โ **ะะพะดะดะตัะถะบะฐ** โ ัะธััะฐั ะฐััะธัะตะบัััะฐ, ะปะตะณะบะพ ัะฐััะธัััั
6. โ **ะขะตััะธัะพะฒะฐะฝะธะต** โ ะฟะพะบัััะธะต ัะตััะฐะผะธ
7. โ **ะะตะฟะปะพะน** โ ะฐะฒัะพะผะฐัะธัะตัะบะธะน CI/CD

---

## ๐ ะกะปะตะดัััะธะต ัะฐะณะธ

1. โ **ะฃัะฒะตัะดะธัั ะฐััะธัะตะบัััั ั ะทะฐะบะฐะทัะธะบะพะผ**
2. โ **ะะฐัะฐัั ะญัะฐะฟ 1:** Backend ะธะฝััะฐััััะบัััะฐ
3. โณ **ะกะพะทะดะฐัั ะฟะตัะฒัะต endpoints** (auth)
4. โณ **ะกะพะทะดะฐัั Login page** (frontend)
5. โณ **ะะฝัะตะณัะธัะพะฒะฐัั Telegram WebApp SDK**

---

## ๐ ะะพะฝัะฐะบัั

**GitHub:** [geodez/vending-admin-v2](https://github.com/geodez/vending-admin-v2)  
**ะกัะฐััะน ะฟัะพะตะบั (ัะฟัะฐะฒะพัะฝะธะบ):** [geodez/vending](https://github.com/geodez/vending)

---

**ะะฒัะพั:** AI Developer  
**ะะฐัะฐ:** 12.01.2026  
**ะะตััะธั:** 1.0

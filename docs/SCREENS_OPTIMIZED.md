# 📱 Оптимизированные экраны админ-панели (3 экрана)

**Было:** 9 отдельных экранов  
**Стало:** 3 мощных экрана с вкладками

---

## 🎯 Принцип объединения

Объединяем экраны по **смысловым блокам**:
1. **Аналитика** (просмотр данных, метрики, отчеты)
2. **Управление** (настройка рецептов, ингредиентов, привязки)
3. **Настройки** (пользователи, конфигурация системы)

---

## 📊 Экран 1: Аналитика и Отчеты

**Роуты:** `/analytics`  
**Доступ:** Owner ✅, Operator ✅ (но с ограничениями по вкладкам)

### Вкладки экрана:

#### 📈 1.1. Обзор (Dashboard)
**Что объединили:** 
- Старый экран "Обзор"
- KPI из "Отчета собственника"

**Компоненты:**
```
┌─────────────────────────────────────────────────────────┐
│  [🔍 Фильтры: период | локация | терминал]             │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📊 KPI Карточки (Owner: все, Operator: без чистой ⭐)  │
│  ┌──────────┬──────────┬──────────┬──────────┐         │
│  │ Выручка  │ Продажи  │ Ср.чек   │ Валовая  │         │
│  │ 125,000₽ │   1,250  │   100₽   │ прибыль  │         │
│  └──────────┴──────────┴──────────┤  70,000₽ │         │
│  │ Пер.расх │ Чистая ⭐│ Валовая  │ Чистая ⭐│         │
│  │  15,000₽ │ 55,000₽  │  маржа   │  маржа   │         │
│  └──────────┴──────────┤   56%    │   44%    │         │
│                         └──────────┴──────────┘         │
│                                                          │
│  📉 График: Выручка и Прибыль по дням                   │
│  [Линейный график с двумя линиями]                      │
│                                                          │
│  🚨 Критические алерты                                  │
│  ┌──────────────────────────────────────────────┐       │
│  │ 🔴 Молоко: осталось 2.5л (< 3 дней)         │       │
│  │ 🟡 Кофе зерно: 6 дней до окончания           │       │
│  └──────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────┘

⭐ — доступно только Owner
```

**Права доступа:**
- Owner: видит всё
- Operator: видит всё, кроме "Чистая прибыль" и "Чистая маржа"

---

#### 📊 1.2. Продажи
**Что объединили:**
- Старый экран "Продажи"

**Компоненты:**
```
┌─────────────────────────────────────────────────────────┐
│  [🔍 Фильтры: период | локация | терминал]             │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📈 Графики                                             │
│  [График 1: Выручка по дням]                            │
│  [График 2: Валовая прибыль по дням]                    │
│                                                          │
│  📋 Таблица продаж по напиткам                          │
│  ┌────────┬────┬────────┬──────┬────────┬──────┐       │
│  │ Напиток│Кол │Выручка │ COGS │Валовая │Маржа │       │
│  │        │    │        │      │прибыль │  %   │       │
│  ├────────┼────┼────────┼──────┼────────┼──────┤       │
│  │Капучино│250 │25,000₽ │8,500₽│16,500₽ │ 66% │       │
│  │Латте   │180 │21,600₽ │7,200₽│14,400₽ │ 67% │       │
│  │Эспрессо│320 │16,000₽ │4,800₽│11,200₽ │ 70% │       │
│  │⚠️ Без  │ 25 │ 2,500₽ │  —   │   —    │  —  │       │
│  │рецепта │    │        │      │        │     │       │
│  └────────┴────┴────────┴──────┴────────┴──────┘       │
│                                                          │
│  💡 Сортировка: по выручке | по количеству | по марже  │
└─────────────────────────────────────────────────────────┘
```

**Права доступа:** Owner ✅, Operator ✅

---

#### 📦 1.3. Склад и расходы
**Что объединили:**
- Старый экран "Склад" (3 подвкладки)
- Старый экран "Переменные расходы"

**Структура:** 4 подвкладки

**Подвкладка 1.3.1: Остатки**
```
┌─────────────────────────────────────────────────────────┐
│  [🔍 Фильтр: локация]                                   │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📋 Таблица остатков                                    │
│  ┌──────────┬────────┬──┬────────┬────────┬────────┐   │
│  │Ингредиент│Остаток │Ед│Расход/ │Осталось│Статус  │   │
│  │          │        │  │ день   │дней    │        │   │
│  ├──────────┼────────┼──┼────────┼────────┼────────┤   │
│  │Кофе зерно│5.2 кг  │кг│0.8 кг  │6 дней  │🟡 Преду│   │
│  │          │        │  │        │        │преждение│   │
│  │Молоко    │12 л    │л │3.5 л   │3 дня   │🔴 Крити│   │
│  │          │        │  │        │        │чно     │   │
│  │Сахар     │2.5 кг  │кг│0.3 кг  │8 дней  │✅ ОК   │   │
│  └──────────┴────────┴──┴────────┴────────┴────────┘   │
│                                                          │
│  [+ Добавить загрузку]                                  │
└─────────────────────────────────────────────────────────┘
```

**Подвкладка 1.3.2: Загрузки (История)**
```
┌─────────────────────────────────────────────────────────┐
│  [🔍 Фильтры: период | локация]                         │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📋 История загрузок (последние 50)                     │
│  ┌─────────┬──────────┬──────────┬─────────┬────────┐  │
│  │  Дата   │ Локация  │Ингредиент│Количество│Коммент│  │
│  ├─────────┼──────────┼──────────┼─────────┼────────┤  │
│  │11.01.26 │Островского│Кофе зерно│10 кг    │Закупка │  │
│  │10.01.26 │ЦУМ       │Молоко    │20 л     │Доставка│  │
│  └─────────┴──────────┴──────────┴─────────┴────────┘  │
│                                                          │
│  [+ Добавить загрузку]                                  │
└─────────────────────────────────────────────────────────┘
```

**Подвкладка 1.3.3: Расход по дням**
```
┌─────────────────────────────────────────────────────────┐
│  [🔍 Фильтры: период | локация | ингредиент]           │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📈 График расхода ингредиентов по дням                 │
│  [Линейный график с выбором ингредиента]                │
│                                                          │
│  📋 Таблица расхода                                     │
│  ┌─────────┬──────────┬──────────────┐                 │
│  │  День   │Ингредиент│  Расход      │                 │
│  ├─────────┼──────────┼──────────────┤                 │
│  │11.01.26 │Кофе зерно│0.85 кг       │                 │
│  │10.01.26 │Кофе зерно│0.78 кг       │                 │
│  └─────────┴──────────┴──────────────┘                 │
└─────────────────────────────────────────────────────────┘
```

**Подвкладка 1.3.4: Переменные расходы**
```
┌─────────────────────────────────────────────────────────┐
│  [🔍 Фильтры: период | локация | категория]            │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  💰 Сводка переменных расходов за период                │
│  ┌────────────────┬──────────────┐                      │
│  │ Аренда         │ 45,000₽      │                      │
│  │ Транспорт      │  8,500₽      │                      │
│  │ Обслуживание   │  3,200₽      │                      │
│  │ Салфетки/стак. │  1,800₽      │                      │
│  │ Прочее         │  2,500₽      │                      │
│  ├────────────────┼──────────────┤                      │
│  │ ИТОГО          │ 61,000₽      │                      │
│  └────────────────┴──────────────┘                      │
│                                                          │
│  📊 График: Pie chart по категориям                     │
│                                                          │
│  📋 Таблица расходов                                    │
│  ┌──────┬─────────┬────────┬──────────┬──────┬──────┐  │
│  │ Дата │ Локация │Терминал│ Категория│ Сумма│Коммент│ │
│  ├──────┼─────────┼────────┼──────────┼──────┼──────┤  │
│  │10.01 │Остров.  │Терм#1  │Аренда    │15,000│Месяч.│  │
│  │09.01 │ЦУМ      │—       │Транспорт │2,500 │Доставка│ │
│  └──────┴─────────┴────────┴──────────┴──────┴──────┘  │
│                                                          │
│  [+ Добавить расход]                                    │
└─────────────────────────────────────────────────────────┘
```

**Права доступа:** Owner ✅, Operator ✅

---

#### 📊 1.4. Отчет собственника ⭐
**Что объединили:**
- Старый экран "Отчет собственника"

**Компоненты:**
```
┌─────────────────────────────────────────────────────────┐
│  ⭐ ТОЛЬКО ДЛЯ СОБСТВЕННИКА                             │
│  [🔍 Фильтры: период | локация | терминал]             │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  💰 Финансовая сводка                                   │
│  ┌──────────────────┬──────────────┐                    │
│  │ Выручка          │ 125,000₽     │                    │
│  │ COGS             │  55,000₽     │                    │
│  │ Валовая прибыль  │  70,000₽     │                    │
│  │ Валовая маржа    │    56%       │                    │
│  │                  │              │                    │
│  │ Переменные расх. │  15,000₽     │                    │
│  │ Чистая прибыль   │  55,000₽     │                    │
│  │ Чистая маржа     │    44%       │                    │
│  └──────────────────┴──────────────┘                    │
│                                                          │
│  📋 Таблица (выбор разреза)                             │
│  [Табы: По дням | По напиткам | По локациям]           │
│                                                          │
│  ⚠️ ЧТО СДЕЛАТЬ (Список проблем)                       │
│  ┌──────────────────────────────────────────────┐       │
│  │ ❌ Несвязанные продажи                       │       │
│  │    Терминал #178428, кнопка 5: 25 продаж    │       │
│  │    → [Привязать к рецепту]                   │       │
│  │                                              │       │
│  │ ⚠️ Ингредиенты без себестоимости             │       │
│  │    "Сироп ваниль": нет цены                  │       │
│  │    → [Добавить цену]                         │       │
│  │                                              │       │
│  │ 🔴 Критичные остатки                         │       │
│  │    Молоко: 2.5л (< 3 дней)                   │       │
│  │    → [Добавить загрузку]                     │       │
│  └──────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────┘
```

**Права доступа:** Owner ✅ only

---

## 🛠️ Экран 2: Управление

**Роуты:** `/management`  
**Доступ:** Owner ✅, Operator ✅

### Вкладки экрана:

#### 🍹 2.1. Рецепты
**Что объединили:**
- Старый экран "Рецепты"
- Часть старого экрана "Кнопки терминала" (привязки)

**Компоненты:**
```
┌─────────────────────────────────────────────────────────┐
│  [🔍 Фильтр: локация]                                   │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📋 Список рецептов                                     │
│  ┌─────────┬──────────┬─────────┬──────────┬──────┐    │
│  │ Рецепт  │ Локация  │Себестои.│Ингредиенты│Статус│    │
│  ├─────────┼──────────┼─────────┼──────────┼──────┤    │
│  │Капучино │Островског│  34₽    │Кофе,Молоко│✅ Акт│    │
│  │         │          │         │          │ивен  │    │
│  │Латте    │Островског│  40₽    │Кофе,Молоко│✅ Акт│    │
│  │         │          │         │,Сироп    │ивен  │    │
│  └─────────┴──────────┴─────────┴──────────┴──────┘    │
│                                                          │
│  [+ Создать рецепт] [📋 Клонировать в другую локацию]  │
│                                                          │
│  ────────────────────────────────────────────────────   │
│                                                          │
│  🔘 Привязки кнопок терминала                           │
│  [Выбор: Локация | Терминал]                            │
│                                                          │
│  ┌──────────┬──────────────────┬─────────┬────────┐    │
│  │Machine ID│Продукт (Vendista)│ Рецепт  │ Статус │    │
│  ├──────────┼──────────────────┼─────────┼────────┤    │
│  │    1     │Капучино 0.2л     │Капучино │✅ Привя│    │
│  │          │                  │         │ зан    │    │
│  │    2     │Латте 0.3л        │Латте    │✅ Привя│    │
│  │          │                  │         │ зан    │    │
│  │    3     │Эспрессо          │—        │⚠️ Не   │    │
│  │          │                  │         │привязан│    │
│  └──────────┴──────────────────┴─────────┴────────┘    │
│                                                          │
│  [🔗 Массовая привязка] [📋 Копировать из другой локации]│
└─────────────────────────────────────────────────────────┘
```

**Модальное окно: Создание/редактирование рецепта**
```
┌───────────────────────────────────────────┐
│ Создать рецепт                            │
├───────────────────────────────────────────┤
│ Название: [__________]                    │
│ Локация:  [Dropdown ▼]                    │
│                                           │
│ Состав рецепта:                           │
│ ┌──────────┬───────┬───────┬─────┐       │
│ │Ингредиент│Кол-во │Ед.изм.│ [x] │       │
│ ├──────────┼───────┼───────┼─────┤       │
│ │Кофе зерно│  18   │  г    │ [x] │       │
│ │Молоко    │ 120   │  мл   │ [x] │       │
│ └──────────┴───────┴───────┴─────┘       │
│                                           │
│ [+ Добавить ингредиент]                   │
│                                           │
│ Себестоимость порции: 34₽                 │
│                                           │
│ [Сохранить] [Отмена]                      │
└───────────────────────────────────────────┘
```

**Права доступа:** Owner ✅, Operator ✅

---

#### 🥤 2.2. Ингредиенты
**Что объединили:**
- Старый экран "Ингредиенты"

**Компоненты:**
```
┌─────────────────────────────────────────────────────────┐
│  [🔍 Поиск ингредиента]                                 │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📋 Справочник ингредиентов                             │
│  ┌───────┬──────────┬─────────┬──┬────────┬──────┬───┐ │
│  │ Код   │Название  │Тип расх.│Ед│Упаковка│Цена/ │Ста│ │
│  │       │          │         │  │        │ед.   │тус│ │
│  ├───────┼──────────┼─────────┼──┼────────┼──────┼───┤ │
│  │COFFEE │Кофе зерно│Постоянн.│г │1000 г  │1.9₽/г│✅ │ │
│  │_BEANS │          │         │  │        │      │   │ │
│  │MILK   │Молоко    │Постоянн.│мл│1000 мл │0.08₽ │✅ │ │
│  │       │          │         │  │        │/мл   │   │ │
│  │SUGAR  │Сахар     │Переменн.│г │1000 г  │0.05₽ │✅ │ │
│  │       │          │         │  │        │/г    │   │ │
│  └───────┴──────────┴─────────┴──┴────────┴──────┴───┘ │
│                                                          │
│  [+ Добавить ингредиент]                                │
└─────────────────────────────────────────────────────────┘
```

**Модальное окно: Создание/редактирование ингредиента**
```
┌───────────────────────────────────────────┐
│ Добавить ингредиент                       │
├───────────────────────────────────────────┤
│ Код:          [__________]                │
│ Название:     [__________]                │
│ Название (RU): [__________]               │
│                                           │
│ Тип расхода:                              │
│  ○ Постоянный (складской)                 │
│  ○ Переменный (только справочно)          │
│                                           │
│ Единица: [Dropdown: г, мл, шт ▼]         │
│ Ед. (RU): [__________]                    │
│                                           │
│ Упаковка:                                 │
│  Кол-во в упаковке: [____] [ед.]         │
│  Цена упаковки:     [____] ₽             │
│                                           │
│ 💰 Цена за единицу: 1.9 ₽ (расчет)       │
│                                           │
│ Пороги алертов:                           │
│  Мин. остаток:  [____] [ед.]             │
│  Мин. дней:     [____] дней              │
│                                           │
│ [Сохранить] [Отмена]                      │
└───────────────────────────────────────────┘
```

**Права доступа:** Owner ✅, Operator ✅

---

## ⚙️ Экран 3: Настройки ⭐

**Роуты:** `/settings`  
**Доступ:** Owner ✅ only

### Вкладки экрана:

#### 👥 3.1. Пользователи
**Что объединили:**
- Часть старого экрана "Настройки" (пользователи)

**Компоненты:**
```
┌─────────────────────────────────────────────────────────┐
│  ⭐ ТОЛЬКО ДЛЯ СОБСТВЕННИКА                             │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  👥 Список пользователей                                │
│  ┌────────────┬─────────┬─────────┬────────┬──────────┐│
│  │Telegram ID │ Имя     │ Роль    │ Статус │Дата добав│││
│  ├────────────┼─────────┼─────────┼────────┼──────────┤│
│  │ 123456789  │Ivan I.  │Owner    │✅ Актив│01.01.2026││
│  │ 987654321  │Petr P.  │Operator │✅ Актив│05.01.2026││
│  └────────────┴─────────┴─────────┴────────┴──────────┘│
│                                                          │
│  [+ Добавить пользователя]                              │
└─────────────────────────────────────────────────────────┘
```

**Модальное окно: Добавление пользователя**
```
┌───────────────────────────────────────────┐
│ Добавить пользователя                     │
├───────────────────────────────────────────┤
│ Telegram User ID: [__________]            │
│                                           │
│ Роль:                                     │
│  ○ Собственник (Owner)                    │
│  ○ Оператор (Operator)                    │
│                                           │
│ Права Operator:                           │
│  ✅ Просмотр аналитики                    │
│  ✅ Управление рецептами                  │
│  ✅ Управление ингредиентами              │
│  ✅ Привязка кнопок                       │
│  ✅ Ввод загрузок и расходов              │
│  ❌ Отчет собственника                    │
│  ❌ Настройки                             │
│                                           │
│ [Добавить] [Отмена]                       │
└───────────────────────────────────────────┘
```

**Права доступа:** Owner ✅ only

---

#### 🏢 3.2. Локации и терминалы
**Что объединили:**
- Часть старого экрана "Настройки" (маппинг терминалов)

**Компоненты:**
```
┌─────────────────────────────────────────────────────────┐
│  ⭐ ТОЛЬКО ДЛЯ СОБСТВЕННИКА                             │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  🏢 Локации                                             │
│  ┌──────────────────┬──────────────────────┐           │
│  │ ID │ Название    │ Терминалов           │           │
│  ├────┼─────────────┼──────────────────────┤           │
│  │ 1  │ Островского │ 2                    │           │
│  │ 2  │ ЦУМ         │ 3                    │           │
│  └────┴─────────────┴──────────────────────┘           │
│                                                          │
│  [+ Добавить локацию]                                   │
│                                                          │
│  ────────────────────────────────────────────────────   │
│                                                          │
│  🖥️ Терминалы                                          │
│  ┌─────────┬────────────────┬──────────────┬─────────┐ │
│  │Term ID  │Terminal Comment│Имя вручную   │ Локация │ │
│  │         │(Vendista)      │              │         │ │
│  ├─────────┼────────────────┼──────────────┼─────────┤ │
│  │ 145912  │Островского Т#1 │—             │Островско│ │
│  │         │                │              │го       │ │
│  │ 178428  │ЦУМ Точка2      │ЦУМ 2-й этаж  │ЦУМ      │ │
│  └─────────┴────────────────┴──────────────┴─────────┘ │
│                                                          │
│  💡 Приоритет отображения:                              │
│     1) Имя вручную (если задано)                        │
│     2) Terminal Comment                                 │
│     3) Fallback: "Терминал #[ID]"                       │
└─────────────────────────────────────────────────────────┘
```

**Права доступа:** Owner ✅ only

---

#### 📂 3.3. Категории расходов
**Что объединили:**
- Часть старого экрана "Настройки" (категории)

**Компоненты:**
```
┌─────────────────────────────────────────────────────────┐
│  ⭐ ТОЛЬКО ДЛЯ СОБСТВЕННИКА                             │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  📂 Справочник категорий переменных расходов            │
│  ┌────────────────────────────────────────┐             │
│  │ Название                                │             │
│  ├────────────────────────────────────────┤             │
│  │ Аренда                                 │             │
│  │ Транспорт                              │             │
│  │ Обслуживание                           │             │
│  │ Салфетки/стаканы                       │             │
│  │ Прочее                                 │             │
│  └────────────────────────────────────────┘             │
│                                                          │
│  [+ Добавить категорию]                                 │
└─────────────────────────────────────────────────────────┘
```

**Права доступа:** Owner ✅ only

---

## 📱 Навигация (Bottom Nav для мобильной)

```
┌─────────────────────────────────────────────────┐
│  [📊 Аналитика] [🛠️ Управление] [⚙️ Настройки] │
└─────────────────────────────────────────────────┘
```

Для Owner: 3 кнопки  
Для Operator: 2 кнопки (без "Настройки")

---

## 🎯 Итоговая структура

### **Было: 9 экранов**
1. Обзор
2. Продажи
3. Склад
4. Рецепты
5. Ингредиенты
6. Кнопки терминала
7. Переменные расходы
8. Отчет собственника
9. Настройки

### **Стало: 3 экрана**

#### **Экран 1: Аналитика** (Owner + Operator)
- 1.1. Обзор (Dashboard)
- 1.2. Продажи
- 1.3. Склад и расходы
  - Остатки
  - Загрузки
  - Расход по дням
  - Переменные расходы
- 1.4. Отчет собственника ⭐ (Owner only)

#### **Экран 2: Управление** (Owner + Operator)
- 2.1. Рецепты (+ привязки кнопок)
- 2.2. Ингредиенты

#### **Экран 3: Настройки** ⭐ (Owner only)
- 3.1. Пользователи
- 3.2. Локации и терминалы
- 3.3. Категории расходов

---

## ✅ Преимущества новой структуры

1. ✅ **Меньше кликов** — всё логически сгруппировано
2. ✅ **Понятная навигация** — 3 больших блока вместо 9 разрозненных
3. ✅ **Быстрый доступ** — вкладки внутри экранов
4. ✅ **Меньше когнитивной нагрузки** — пользователь сразу понимает где что
5. ✅ **Удобнее на мобильных** — меньше переключений между экранами

---

## 📊 Маппинг экранов

| Старый экран | Новый экран | Вкладка |
|--------------|-------------|---------|
| Обзор | Аналитика | 1.1. Обзор |
| Продажи | Аналитика | 1.2. Продажи |
| Склад → Остатки | Аналитика | 1.3. Склад → Остатки |
| Склад → Загрузки | Аналитика | 1.3. Склад → Загрузки |
| Склад → Расход | Аналитика | 1.3. Склад → Расход |
| Переменные расходы | Аналитика | 1.3. Склад → Переменные расходы |
| Отчет собственника | Аналитика | 1.4. Отчет собственника ⭐ |
| Рецепты | Управление | 2.1. Рецепты |
| Кнопки терминала | Управление | 2.1. Рецепты (привязки) |
| Ингредиенты | Управление | 2.2. Ингредиенты |
| Настройки → Пользователи | Настройки ⭐ | 3.1. Пользователи |
| Настройки → Маппинг | Настройки ⭐ | 3.2. Локации и терминалы |
| Настройки → Категории | Настройки ⭐ | 3.3. Категории расходов |

---

**Итого: 9 экранов → 3 экрана с вкладками** ✅

# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Ç–ª–∞–¥–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞: –í–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ

–ï—Å–ª–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram WebApp –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ –∑–∞–≥—Ä—É–∑–∫–µ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ:

---

## 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

**–û—Ç–∫—Ä–æ–π—Ç–µ DevTools –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console:**

```javascript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ —Ç–∏–ø–∞:

üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp...
üìä –î–∞–Ω–Ω—ã–µ Telegram: {userData: {...}, appInitData: "...", scheme: "light"}
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω: 602720033, Roman
üîê initData –ø–æ–ª—É—á–µ–Ω (–¥–ª–∏–Ω–∞: 450)
üì± –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...
initData –¥–ª–∏–Ω–∞: 450
```

### –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤—Ä–æ–¥–µ:

```
‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp
‚ö†Ô∏è WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ —á–µ—Ä–µ–∑ Telegram! 
- –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞** @coffeekznebot
- –ù–ï –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ http://...

---

## 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ Network –∑–∞–ø—Ä–æ—Å–æ–≤

**–í–∫–ª–∞–¥–∫–∞ Network –≤ DevTools:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **DevTools ‚Üí Network**
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/v1/auth/telegram`

### ‚úÖ –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω:
```
Status: 200
Response: {
  "access_token": "eyJhbGc...",
  "token_type": "bearer",
  "user": {
    "id": 1,
    "telegram_user_id": 602720033,
    "username": "...",
    ...
  }
}
```

### ‚ùå –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 401:
```
Status: 401
Response: "Invalid Telegram authentication data"
```
**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π Telegram –¥–∞–Ω–Ω—ã—Ö
- `TELEGRAM_BOT_TOKEN` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- initData —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–µ (>24 —á–∞—Å–æ–≤ –≤ production —Ä–µ–∂–∏–º–µ)

### ‚ùå –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 403:
```
Status: 403
Response: "User not registered in the system"
```
**–ü—Ä–∏—á–∏–Ω–∞:** –í–∞—à `telegram_user_id` –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ë–î!

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
SELECT * FROM users WHERE telegram_user_id = 602720033;

-- –ï—Å–ª–∏ –ø—É—Å—Ç–æ, –¥–æ–±–∞–≤—å—Ç–µ:
INSERT INTO users (telegram_user_id, first_name, role, is_active)
VALUES (602720033, 'Roman', 'owner', true);
```

### ‚ùå –ï—Å–ª–∏ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ (timeout):
```
Status: (canceled) –∏–ª–∏ (timeout)
```
**–ü—Ä–∏—á–∏–Ω—ã:**
- –ë—ç–∫–µ–Ω–¥ –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å API (`API_BASE_URL`)
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é –∏–ª–∏ CORS

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω:
curl http://155.212.160.190:8000/health
```

---

## 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–±—ç–∫–µ–Ω–¥)

### –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–¥–æ—Ä–æ–≤ –ª–∏ –±—ç–∫–µ–Ω–¥:
curl http://155.212.160.190:8000/

# –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
{"status":"ok","message":"Vending Admin v2 API is running","version":"1.0.0"}
```

### –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh user@155.212.160.190

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞:
cd /opt/vending-admin-v2/backend
docker-compose logs -f api

# –ò—â–∏—Ç–µ –ª–æ–≥–∏ —Ç–∏–ø–∞:
DEBUG: –ü–æ–ª—É—á–µ–Ω initData: query_id=...
DEBUG: –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Telegram: {'user_id': 602720033, ...}
DEBUG: –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å telegram_user_id: 602720033
DEBUG: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º JWT —Ç–æ–∫–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1
DEBUG: JWT —Ç–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
```

### –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∞—Ö:
```
DEBUG: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω! telegram_user_id=602720033
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ, –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ë–î:
docker-compose exec db psql -U vending -d vending

# SQL:
INSERT INTO users (telegram_user_id, first_name, role, is_active)
VALUES (602720033, 'Roman', 'owner', true);
```

---

## 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):

–§–∞–π–ª `.env` –≤ –ø–∞–ø–∫–µ `/backend`:
```bash
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
SECRET_KEY=your-secret-key
DEBUG=true
```

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (production):

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh user@155.212.160.190

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env –≤ –ø–∞–ø–∫–µ –¥–µ–ø–ª–æ—è:
cat /opt/vending-admin-v2/backend/.env

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
# - TELEGRAM_BOT_TOKEN (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω!)
# - SECRET_KEY (—Ç–æ—Ç –∂–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤)
# - DEBUG=false (–≤ production)
```

---

## 5Ô∏è‚É£ –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–ª–∞–¥–∫–∏

### –®–∞–≥ 1: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ Telegram
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–≤–µ–¥–∏—Ç–µ:
typeof WebApp !== 'undefined' ? 'Telegram OK' : 'NOT in Telegram'
// –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: "Telegram OK"
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ initData
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
const { WebApp } = window;
console.log('User:', WebApp?.initDataUnsafe?.user);
console.log('InitData length:', WebApp?.initData?.length);
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ:
curl -X POST http://155.212.160.190:8000/api/v1/auth/telegram \
  -H "Content-Type: application/json" \
  -d '{"init_data":"test"}'

# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ (–Ω–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª):
# {"detail":"Invalid Telegram authentication data"}
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î
```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
ssh user@155.212.160.190
cd /opt/vending-admin-v2/backend

# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î:
docker-compose exec db psql -U vending -d vending

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
SELECT id, telegram_user_id, first_name, role, is_active FROM users;
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
docker-compose logs -f api --tail=50
```

---

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|----------|
| "WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω" | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ —á–µ—Ä–µ–∑ Telegram | –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ |
| Timeout –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ | –ë—ç–∫–µ–Ω–¥ –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –∞–¥—Ä–µ—Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `API_BASE_URL` –∏ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ |
| "User not registered" | Telegram ID –Ω–µ –≤ –ë–î | –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î |
| "Invalid authentication data" | –ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π Telegram | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_TOKEN` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ |
| "Invalid token" (–ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞) | –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞ –ë–î | –û—á–∏—Å—Ç–∏—Ç–µ localStorage –∏ –ª–æ–≥–∏–Ω–∏—Ç–µ—Å—å –∑–∞–Ω–æ–≤–æ |

---

## üì± –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞

```
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ @coffeekznebot
2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Telegram WebApp
3. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞ –Ω–∞–∂–∞—Ç—å "–í–æ–π—Ç–∏"
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è POST /api/v1/auth/telegram —Å initData
5. –ë—ç–∫–µ–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –æ—Ç Telegram
6. –ë—ç–∫–µ–Ω–¥ –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
7. –°–æ–∑–¥–∞–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω
8. –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
9. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É /overview
10. –í—Å–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization
```

---

## üÜò –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)** –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
2. **–û—Ç–∫—Ä–æ–π—Ç–µ Network** –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
3. **SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î** - –µ—Å—Ç—å –ª–∏ –≤—ã —Ç–∞–º –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏:
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
cd /opt/vending-admin-v2/backend
docker-compose restart api
```

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–í—Å–µ –Ω–æ–≤—ã–µ –ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —ç–º–æ–¥–∑–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞:
- üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- üì± –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
- üìä –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£—Å–ø–µ—Ö
- ‚ùå –û—à–∏–±–∫–∞
- ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ
- üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- üì° API
